<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MCX Trading Dashboard - Honest Edition</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 20px;
            padding: 20px;
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        h1 {
            font-size: 2.5em;
            background: linear-gradient(90deg, #00d4ff, #7b2cbf);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .subtitle {
            color: #ff6b6b;
            font-size: 1.1em;
            margin-top: 10px;
        }
        
        /* Warning Banner */
        .warning-banner {
            background: linear-gradient(90deg, #ff6b6b22, #ff000022);
            border: 2px solid #ff6b6b;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .warning-banner h3 {
            color: #ff6b6b;
            margin-bottom: 10px;
        }
        
        .warning-banner p {
            color: #ffb4b4;
        }
        
        /* Grid Layout */
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .card {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .card-title {
            font-size: 1.2em;
            color: #00d4ff;
            margin-bottom: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding-bottom: 10px;
        }
        
        /* Price Card */
        .price-main {
            font-size: 3em;
            font-weight: bold;
            text-align: center;
            margin: 20px 0;
        }
        
        .price-change {
            text-align: center;
            font-size: 1.5em;
            padding: 10px;
            border-radius: 8px;
        }
        
        .price-change.positive {
            background: rgba(0,255,127,0.2);
            color: #00ff7f;
        }
        
        .price-change.negative {
            background: rgba(255,99,71,0.2);
            color: #ff6347;
        }
        
        /* Indicator Grid */
        .indicator-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }
        
        .indicator {
            background: rgba(255,255,255,0.03);
            padding: 12px;
            border-radius: 8px;
            text-align: center;
        }
        
        .indicator-label {
            color: #aaa;
            font-size: 0.85em;
        }
        
        .indicator-value {
            font-size: 1.3em;
            font-weight: bold;
            margin-top: 5px;
        }
        
        /* Signal Card */
        .signal-item {
            background: rgba(255,255,255,0.03);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid #666;
        }
        
        .signal-item.buy {
            border-left-color: #00ff7f;
        }
        
        .signal-item.sell {
            border-left-color: #ff6347;
        }
        
        .signal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .signal-name {
            font-weight: bold;
        }
        
        .signal-direction {
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 0.85em;
            font-weight: bold;
        }
        
        .signal-direction.buy {
            background: rgba(0,255,127,0.3);
            color: #00ff7f;
        }
        
        .signal-direction.sell {
            background: rgba(255,99,71,0.3);
            color: #ff6347;
        }
        
        .signal-reason {
            color: #aaa;
            font-size: 0.9em;
            margin-bottom: 8px;
        }
        
        .signal-accuracy {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .accuracy-bar {
            flex: 1;
            height: 8px;
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .accuracy-fill {
            height: 100%;
            border-radius: 4px;
        }
        
        .accuracy-fill.poor {
            background: #ff6b6b;
        }
        
        .accuracy-fill.fair {
            background: #ffd93d;
        }
        
        .accuracy-fill.good {
            background: #6bcb77;
        }
        
        .accuracy-label {
            font-size: 0.85em;
            color: #888;
            white-space: nowrap;
        }
        
        /* Consensus Card */
        .consensus-box {
            text-align: center;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 15px;
        }
        
        .consensus-box.bullish {
            background: linear-gradient(135deg, rgba(0,255,127,0.2), rgba(0,128,64,0.2));
            border: 2px solid #00ff7f;
        }
        
        .consensus-box.bearish {
            background: linear-gradient(135deg, rgba(255,99,71,0.2), rgba(128,50,36,0.2));
            border: 2px solid #ff6347;
        }
        
        .consensus-box.neutral {
            background: linear-gradient(135deg, rgba(255,217,61,0.2), rgba(128,108,30,0.2));
            border: 2px solid #ffd93d;
        }
        
        .consensus-direction {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .consensus-confidence {
            font-size: 1.2em;
            color: #aaa;
        }
        
        .consensus-warning {
            margin-top: 15px;
            padding: 10px;
            background: rgba(255,107,107,0.2);
            border-radius: 8px;
            font-size: 0.9em;
            color: #ff6b6b;
        }
        
        /* Backtest Results */
        .backtest-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .backtest-table th,
        .backtest-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .backtest-table th {
            color: #00d4ff;
            font-weight: normal;
        }
        
        .accuracy-badge {
            padding: 4px 10px;
            border-radius: 4px;
            font-weight: bold;
        }
        
        .accuracy-badge.poor {
            background: rgba(255,107,107,0.3);
            color: #ff6b6b;
        }
        
        .accuracy-badge.fair {
            background: rgba(255,217,61,0.3);
            color: #ffd93d;
        }
        
        /* Last 3 Days */
        .days-container {
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        
        .day-box {
            flex: 1;
            text-align: center;
            padding: 15px;
            border-radius: 10px;
            background: rgba(255,255,255,0.03);
        }
        
        .day-box.up {
            border: 1px solid #00ff7f;
        }
        
        .day-box.down {
            border: 1px solid #ff6347;
        }
        
        .day-label {
            font-size: 0.85em;
            color: #888;
        }
        
        .day-value {
            font-size: 1.3em;
            font-weight: bold;
            margin-top: 5px;
        }
        
        .day-value.up {
            color: #00ff7f;
        }
        
        .day-value.down {
            color: #ff6347;
        }
        
        /* Footer */
        footer {
            text-align: center;
            padding: 20px;
            color: #666;
            font-size: 0.9em;
        }
        
        /* Refresh Button */
        .refresh-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #00d4ff, #7b2cbf);
            border: none;
            color: white;
            font-size: 1.5em;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,212,255,0.4);
            transition: transform 0.3s;
        }
        
        .refresh-btn:hover {
            transform: scale(1.1);
        }
        
        /* Loading */
        .loading {
            text-align: center;
            padding: 50px;
            color: #aaa;
        }
        
        /* Disclaimer */
        .disclaimer {
            background: rgba(255,255,255,0.03);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            color: #888;
            font-size: 0.9em;
            margin-top: 20px;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .live-dot {
            display: inline-block;
            width: 10px;
            height: 10px;
            background: #00ff7f;
            border-radius: 50%;
            animation: pulse 2s infinite;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üìä MCX Trading Dashboard</h1>
            <p class="subtitle">‚ö†Ô∏è HONEST EDITION - Real Accuracy Metrics</p>
        </header>
        
        <div class="warning-banner">
            <h3>‚ö° IMPORTANT: Reality Check</h3>
            <p>Best backtest accuracy: <strong>52.1%</strong> (MA Crossover) ‚Ä¢ ML Models: <strong>~50%</strong> (coin flip) ‚Ä¢ Focus on <strong>risk management</strong>, not prediction!</p>
        </div>
        
        <div id="dashboard" class="loading">
            Loading data...
        </div>
        
        <button class="refresh-btn" onclick="loadData()">üîÑ</button>
    </div>
    
    <script>
        async function loadData() {
            try {
                const response = await fetch('/api/data');
                const result = await response.json();
                
                if (result.success) {
                    renderDashboard(result.data);
                } else {
                    document.getElementById('dashboard').innerHTML = `<p class="loading">Error: ${result.error}</p>`;
                }
            } catch (error) {
                document.getElementById('dashboard').innerHTML = `<p class="loading">Error loading data: ${error.message}</p>`;
            }
        }
        
        function renderDashboard(data) {
            const html = `
                <div class="grid">
                    <!-- Price Card -->
                    <div class="card">
                        <div class="card-title"><span class="live-dot"></span>MCX Ltd (NSE) - Live</div>
                        <div class="price-main">‚Çπ${data.price.toLocaleString()}</div>
                        <div class="price-change ${data.change >= 0 ? 'positive' : 'negative'}">
                            ${data.change >= 0 ? '‚ñ≤' : '‚ñº'} ${Math.abs(data.change).toFixed(2)}%
                        </div>
                        <p style="text-align:center; margin-top:15px; color:#888;">
                            Prev Close: ‚Çπ${data.prev_close.toLocaleString()}
                        </p>
                    </div>
                    
                    <!-- Consensus Card -->
                    <div class="card">
                        <div class="card-title">üìä Signal Consensus</div>
                        <div class="consensus-box ${data.consensus.direction.toLowerCase()}">
                            <div class="consensus-direction">${data.consensus.direction}</div>
                            <div class="consensus-confidence">
                                ${data.consensus.buy_count} Buy / ${data.consensus.sell_count} Sell signals
                            </div>
                        </div>
                        <div class="consensus-warning">
                            ‚ö†Ô∏è Remember: Even combined signals only predict direction ~50-52% of the time
                        </div>
                    </div>
                    
                    <!-- Indicators Card -->
                    <div class="card">
                        <div class="card-title">üìà Technical Indicators</div>
                        <div class="indicator-grid">
                            <div class="indicator">
                                <div class="indicator-label">RSI (14)</div>
                                <div class="indicator-value" style="color: ${getRSIColor(data.indicators.rsi)}">${data.indicators.rsi}</div>
                            </div>
                            <div class="indicator">
                                <div class="indicator-label">Volatility</div>
                                <div class="indicator-value">${data.indicators.volatility}%</div>
                            </div>
                            <div class="indicator">
                                <div class="indicator-label">MA5</div>
                                <div class="indicator-value">‚Çπ${data.indicators.ma5}</div>
                            </div>
                            <div class="indicator">
                                <div class="indicator-label">MA20</div>
                                <div class="indicator-value">‚Çπ${data.indicators.ma20}</div>
                            </div>
                            <div class="indicator">
                                <div class="indicator-label">BB Position</div>
                                <div class="indicator-value">${(data.indicators.bb_position * 100).toFixed(0)}%</div>
                            </div>
                            <div class="indicator">
                                <div class="indicator-label">ATR</div>
                                <div class="indicator-value">‚Çπ${data.indicators.atr}</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Last 3 Days Card -->
                    <div class="card">
                        <div class="card-title">üìÖ Last 3 Trading Days</div>
                        <div class="days-container">
                            ${data.last_3_days.map((d, i) => `
                                <div class="day-box ${d >= 0 ? 'up' : 'down'}">
                                    <div class="day-label">Day ${i === 0 ? '-3' : i === 1 ? '-2' : '-1'}</div>
                                    <div class="day-value ${d >= 0 ? 'up' : 'down'}">
                                        ${d >= 0 ? '+' : ''}${d.toFixed(2)}%
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        <p style="text-align:center; margin-top:15px; color:#888; font-size:0.85em;">
                            3-day reversal strategy accuracy: <strong>48.2%</strong> (worse than random)
                        </p>
                    </div>
                </div>
                
                <div class="grid">
                    <!-- Signals Card -->
                    <div class="card">
                        <div class="card-title">üéØ Active Signals (with honest accuracy)</div>
                        ${data.signals.length === 0 ? '<p style="color:#888;">No active signals</p>' : ''}
                        ${data.signals.map(s => `
                            <div class="signal-item ${s.direction.toLowerCase()}">
                                <div class="signal-header">
                                    <span class="signal-name">${s.name}</span>
                                    <span class="signal-direction ${s.direction.toLowerCase()}">${s.direction}</span>
                                </div>
                                <div class="signal-reason">${s.reason}</div>
                                <div class="signal-accuracy">
                                    <div class="accuracy-bar">
                                        <div class="accuracy-fill ${getAccuracyClass(s.accuracy)}" style="width: ${s.accuracy}%"></div>
                                    </div>
                                    <span class="accuracy-label">${s.accuracy}% backtest accuracy</span>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    
                    <!-- Backtest Results Card -->
                    <div class="card">
                        <div class="card-title">üìâ Honest Backtest Results (2 Years)</div>
                        <table class="backtest-table">
                            <tr>
                                <th>Strategy</th>
                                <th>Accuracy</th>
                                <th>Verdict</th>
                            </tr>
                            <tr>
                                <td>RSI Mean Reversion</td>
                                <td><span class="accuracy-badge poor">46.1%</span></td>
                                <td>‚ùå Worse than random</td>
                            </tr>
                            <tr>
                                <td>3-Day Reversal</td>
                                <td><span class="accuracy-badge poor">48.2%</span></td>
                                <td>‚ùå Worse than random</td>
                            </tr>
                            <tr>
                                <td>Bollinger Bounce</td>
                                <td><span class="accuracy-badge fair">51.0%</span></td>
                                <td>üòê Barely even</td>
                            </tr>
                            <tr>
                                <td>MA Crossover</td>
                                <td><span class="accuracy-badge fair">52.1%</span></td>
                                <td>üòê Best (barely)</td>
                            </tr>
                            <tr>
                                <td>ML Ensemble</td>
                                <td><span class="accuracy-badge fair">50.8%</span></td>
                                <td>üòê Coin flip</td>
                            </tr>
                        </table>
                        <p style="margin-top:15px; color:#ff6b6b; font-size:0.9em;">
                            üí° <strong>Key Insight:</strong> Even 55% accuracy is considered excellent in trading. 
                            Focus on risk management and position sizing, not prediction accuracy.
                        </p>
                    </div>
                </div>
                
                <!-- Support/Resistance -->
                <div class="card" style="max-width:700px; margin:0 auto 20px;">
                    <div class="card-title">üìä Price Levels (20-Day)</div>
                    <div style="display:flex; justify-content:space-around; text-align:center;">
                        <div>
                            <div style="color:#888;">Support</div>
                            <div style="font-size:1.5em; color:#00ff7f;">‚Çπ${data.indicators.support}</div>
                        </div>
                        <div>
                            <div style="color:#888;">Current</div>
                            <div style="font-size:1.5em;">‚Çπ${data.price}</div>
                        </div>
                        <div>
                            <div style="color:#888;">Resistance</div>
                            <div style="font-size:1.5em; color:#ff6347;">‚Çπ${data.indicators.resistance}</div>
                        </div>
                    </div>
                    <div style="margin-top:15px; padding:10px; background:rgba(255,255,255,0.03); border-radius:8px;">
                        <div style="display:flex; align-items:center;">
                            <div style="flex:1; height:6px; background:linear-gradient(90deg, #00ff7f, #ffd93d, #ff6347); border-radius:3px; position:relative;">
                                <div style="position:absolute; left:${((data.price - data.indicators.support) / (data.indicators.resistance - data.indicators.support) * 100).toFixed(0)}%; transform:translateX(-50%); top:-8px;">
                                    <div style="width:4px; height:20px; background:#fff; border-radius:2px;"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="disclaimer">
                    <strong>‚ö†Ô∏è DISCLAIMER:</strong> This dashboard shows HONEST backtest results. 
                    Direction prediction accuracy is ~50% (coin flip level). 
                    This is NOT financial advice. Always use proper risk management. 
                    MCX Lot Size: 625 shares.
                    <br><br>
                    Last Updated: ${data.timestamp}
                </div>
            `;
            
            document.getElementById('dashboard').innerHTML = html;
        }
        
        function getRSIColor(rsi) {
            if (rsi < 30) return '#00ff7f';
            if (rsi > 70) return '#ff6347';
            return '#ffd93d';
        }
        
        function getAccuracyClass(acc) {
            if (acc < 50) return 'poor';
            if (acc < 55) return 'fair';
            return 'good';
        }
        
        // Load data on page load
        loadData();
        
        // Auto-refresh every 60 seconds
        setInterval(loadData, 60000);
    </script>
    
    <footer>
        MCX Trading Dashboard v6.0 - Honest Edition | Built with Flask & Python
    </footer>
</body>
</html>
